# Руководство по автообновлению расширения Chrome

## Как это работает

Chrome автоматически проверяет обновления расширений каждые несколько часов (обычно каждые 5 часов). Если найдена новая версия, расширение обновляется автоматически.

## Настройка автообновления

### Шаг 1: Добавьте update_url в manifest.json

В файле `manifest.json` уже добавлено поле:
```json
"update_url": "https://ваш-домен.com/updates.xml"
```

Замените `https://ваш-домен.com/updates.xml` на реальный URL вашего сервера.

### Шаг 2: Получите ID расширения

1. Установите расширение в Chrome
2. Перейдите на `chrome://extensions/`
3. Включите "Режим разработчика"
4. Скопируйте ID расширения (длинная строка вида: `abcdefghijklmnopqrstuvwxyzabcdef`)

### Шаг 3: Создайте updates.xml на вашем сервере

Создайте файл `updates.xml` со следующим содержимым:

```xml
<?xml version='1.0' encoding='UTF-8'?>
<gupdate xmlns='http://www.google.com/update2/response' protocol='2.0'>
  <app appid='ВАШ_ID_РАСШИРЕНИЯ'>
    <updatecheck codebase='https://ваш-домен.com/extension-v1.0.1.crx' version='1.0.1' />
  </app>
</gupdate>
```

Замените:
- `ВАШ_ID_РАСШИРЕНИЯ` - ID вашего расширения из шага 2
- `https://ваш-домен.com/extension-v1.0.1.crx` - прямая ссылка на .crx файл новой версии
- `version='1.0.1'` - новый номер версии

### Шаг 4: Упакуйте расширение в .crx файл

#### Способ 1: Через Chrome (для разработки)

1. Перейдите на `chrome://extensions/`
2. Включите "Режим разработчика"
3. Нажмите "Упаковать расширение"
4. Выберите папку с расширением
5. Если это первая упаковка, оставьте поле "Файл закрытого ключа" пустым
6. Chrome создаст .crx и .pem файлы
7. **ВАЖНО: Сохраните .pem файл!** Он нужен для создания обновлений

#### Способ 2: Через командную строку

```bash
"C:\Program Files\Google\Chrome\Application\chrome.exe" --pack-extension="C:\путь\к\расширению" --pack-extension-key="C:\путь\к\ключу.pem"
```

### Шаг 5: Разместите файлы на сервере

1. Загрузите `updates.xml` на ваш сервер
2. Загрузите `.crx` файл на ваш сервер
3. Убедитесь, что файлы доступны по HTTPS (обязательно!)

### Шаг 6: Настройте правильные заголовки сервера

Ваш веб-сервер должен отдавать правильные заголовки:

**Для .crx файлов:**
```
Content-Type: application/x-chrome-extension
```

**Для .xml файлов:**
```
Content-Type: application/xml
```

#### Пример для Apache (.htaccess):
```apache
<FilesMatch "\.crx$">
    Header set Content-Type "application/x-chrome-extension"
</FilesMatch>

<FilesMatch "\.xml$">
    Header set Content-Type "application/xml"
</FilesMatch>
```

#### Пример для Nginx:
```nginx
location ~* \.crx$ {
    types { application/x-chrome-extension crx; }
}

location ~* \.xml$ {
    types { application/xml xml; }
}
```

### Шаг 7: Обновление расширения

Когда вы выпускаете новую версию:

1. Увеличьте версию в `manifest.json` (например, с `1.0.0` на `1.0.1`)
2. Упакуйте новую версию в .crx, используя тот же .pem ключ
3. Загрузите новый .crx файл на сервер
4. Обновите `updates.xml`:
   - Измените `version` на новый номер
   - Обновите `codebase` URL на новый .crx файл

## Проверка обновлений вручную

Чтобы принудительно проверить обновления:

1. Откройте `chrome://extensions/`
2. Включите "Режим разработчика"
3. Нажмите "Обновить" вверху страницы

## Важные замечания

⚠️ **HTTPS обязателен!** Chrome не будет загружать обновления по HTTP.

⚠️ **Сохраните .pem файл!** Без него вы не сможете выпускать обновления с тем же ID.

⚠️ **Версии должны расти!** Chrome обновится только если версия в updates.xml больше текущей.

⚠️ **ID расширения привязан к ключу!** Если потеряете .pem файл, придется распространять новое расширение с новым ID.

## Альтернативный способ: Self-hosted обновления

Если у вас нет своего сервера, можно использовать:
- GitHub Pages (бесплатно, HTTPS)
- Netlify (бесплатно, HTTPS)
- Vercel (бесплатно, HTTPS)
- AWS S3 + CloudFront (платно)

## Пример структуры на сервере

```
https://ваш-домен.com/
├── updates.xml
├── releases/
    ├── extension-v1.0.0.crx
    ├── extension-v1.0.1.crx
    └── extension-v1.0.2.crx
```

## Частота проверки обновлений

- Chrome проверяет обновления примерно каждые 5 часов
- При запуске браузера
- При ручном обновлении через chrome://extensions/

## Отладка

Чтобы посмотреть логи обновлений:
1. Откройте `chrome://extensions/`
2. Включите "Режим разработчика"
3. Нажмите "Подробности" на вашем расширении
4. Внизу будет информация о последней проверке обновлений

## Формат версий

Используйте семантическое версионирование:
- `1.0.0` - мажорная.минорная.патч
- `1.0.1` - небольшие исправления
- `1.1.0` - новые функции
- `2.0.0` - серьезные изменения
